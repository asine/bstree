!function(e,s,t,a){"use strict";function i(s,t){this.element=s,this.settings=e.extend({},o,t),this._defaults=o,this._name=l,this._vItem={setInitCount:function(e,s){var t=e.children("ul").children("li").length;e.children("ul").children(s._dotVLineClass).attr("data-vitems",t)},setCount:function(s,t,a){var i=a.getCount(s,t);s.hasClass(t.closedClass)?(i=-i,s.find(t._dotCompositeClass).each(function(s){e(this).hasClass(t.expandedClass)&&e(this).is("li:last-child")&&(i-=a.getCount(e(this),t))})):s.hasClass(t.expandedClass)&&s.find(t._dotCompositeClass).each(function(s){e(this).hasClass(t.expandedClass)&&e(this).is("li:last-child")&&(i+=a.getCount(e(this),t))}),t.DEBUG&&console.log("count = "+i),s.parents(t._dotCompositeClass).each(function(l){var n=e(this),o=a.getCount(n,t),d=o+i;0===l&&s.is("li:last-child")&&(d=o),t.DEBUG&&console.log(l+" : "+d),n.children("ul").children(t._dotVLineClass).attr("data-vitems",d),a.setHeight(n,t,a)})},getCount:function(e,s){var t=e.children("ul").children(s._dotVLineClass).attr("data-vitems");return a==t?-1:parseInt(t)},setHeight:function(e,t,a){var i=a.getCount(e,t),l=0;l=s.hasClass("has-data")?(i-1)*t._datavItemHeight+t._datavLineOffset:(i-1)*t._vItemHeight+t._vLineOffset,e.children("ul").children(t._dotVLineClass).css("height",l)}},this.element.openNode=function(e,s){e.children("ul").show(),e.addClass(s.expandedClass).removeClass(s.closedClass),e.children("div").children(s._dotChevronClass).html(s.chevronOpened+"&nbsp;").attr("title",s.closeTitle)},this.element.closeNode=function(e,s){e.children("ul").hide(),e.addClass(s.closedClass).removeClass(s.expandedClass),e.children("div").children(s._dotChevronClass).html(s.chevronClosed+"&nbsp;").attr("title",s.openTitle)},this._data={},this.settings.dataSource.length&&(this._data={separator:this.settings.dataSeparator,source:this.settings.dataSource,initValues:this.settings.initValues.split(this.settings.dataSeparator),values:this.settings.dataSource.val().split(this.settings.dataSeparator),push:function(){this.source.val(this.values.join(this.separator))},pull:function(){this.values=this.source.val().split(this.separator)},resetIndeterminate:function(e,s){e.removeClass(s.incompleteClass),e.find(s._dotCompositeClass).removeClass(s.incompleteClass),e.children(".checkbox").find(s._dotCheckboxClass).prop("indeterminate",!1),e.find(s._dotCompositeClass).children(".checkbox").find(s._dotCheckboxClass).prop("indeterminate",!1)},propagateToChildren:function(e,s,t){e.find(t._dotCheckboxClass).prop("checked",s)},propagateToParent:function(s,t){s.parents(t._dotNodeClass).each(function(){var s=e(this),a=0;s.children(".checkbox").find(t._dotCheckboxClass).prop("checked")&&a++;var i=s.siblings("li"),l=i.length+1;e.each(i,function(s,i){var l=e(i),n=l.children(".checkbox").find(t._dotCheckboxClass);n.prop("checked")&&a++}),t.DEBUG&&console.log(s.data("level")+" check = "+a+"/"+l);var n=s.parent("ul").parent("li");if(n.length){var o=n.children(".checkbox").find(t._dotCheckboxClass);a==l?o.prop("indeterminate",!1).prop("checked",!0):0==a?(o.prop("indeterminate",!1).prop("checked",!1),n.find("input:checked").length&&o.prop("indeterminate",!0)):o.prop("indeterminate",!0).prop("checked",!1)}})},getLeafData:function(t){var a=[];s.find(t._dotCheckboxClass).each(function(){var s=e(this).closest(t._dotLeafClass);if(e(this).prop("checked")&&s.length){var i=s.data("id");a.push(i)}}),this.values=a}}),this.init()}var l="bstree",n="plugin_"+l,o={DEBUG:!1,dataSource:"",initValues:"",dataSeparator:":",chevronOpened:'<i class="fa fa-toggle-down fa-lg"></i>',chevronClosed:'<i class="fa fa-toggle-right fa-lg"></i>',isExpanded:!1,nodeClass:l+"_node",compositeClass:l+"_composite",leafClass:l+"_leaf",childrenClass:l+"_children",chevronClass:l+"_chevron",labelClass:l+"_label",iconClass:l+"_icon",expandedClass:l+"_expanded",closedClass:l+"_closed",checkboxClass:l+"_checkbox",incompleteClass:l+"_incomplete",vLineClass:l+"_vline",openTitle:"Afficher la branche",closeTitle:"Masquer la branche",checkboxTitle:"Attribuer le périmètre"};e.extend(i.prototype,{init:function(){var s=this.element,t=this.settings,a=this._vItem,i=this._data;if(0==s.length)throw l+" - the element is not valid.";if(t._dotNodeClass="."+t.nodeClass,t._dotCompositeClass="."+t.compositeClass,t._dotLeafClass="."+t.leafClass,t._dotChildrenClass="."+t.childrenClass,t._dotChevronClass="."+t.chevronClass,t._dotExpandedClass="."+t.expandedClass,t._dotCheckboxClass="."+t.checkboxClass,t._dotLabelClass="."+t.labelClass,t._dotIconClass="."+t.iconClass,t._dotVLineClass="."+t.vLineClass,t._vLineOffset=12,t._datavLineOffset=12,t._vItemHeight=32,t._datavItemHeight=36,s.find("li").each(function(){var s=e(this);s.has("ul").length?s.addClass(t.nodeClass+" "+t.compositeClass):s.addClass(t.nodeClass+" "+t.leafClass)}),s.children("ul").find("ul").addClass(t.childrenClass).prepend('<i class="'+t.vLineClass+'"></i>'),s.find("li > span").addClass(t.labelClass).wrap("<div></div>").wrap("<label></label>"),s.find(t._dotLabelClass).before('<span class="'+t.iconClass+'"></span>').parent("label").before('<span class="'+t.chevronClass+'"></span>'),s.find(t._dotCompositeClass).each(function(){t.isExpanded?s.openNode(e(this),t):(s.closeNode(e(this),t),a.setInitCount(e(this),t))}),s.find(t._dotChevronClass).click(function(){var i=e(this).closest(t._dotCompositeClass);i.hasClass(t.closedClass)?s.openNode(i,t):i.hasClass(t.expandedClass)&&s.closeNode(i,t),a.setCount(i,t,a)}),!e.isEmptyObject(i)){s.find(t._dotIconClass).before('<input type="checkbox" class="'+t.checkboxClass+'" title="'+t.checkboxTitle+'">').before('<span class="c-indicator" title="'+t.checkboxTitle+'"></span>').parent("label").addClass("c-input c-checkbox").parent("div").addClass("checkbox"),i.pull(),s.find(t._dotCheckboxClass).change(function(){var s=e(this);if(0==s.closest(t._dotLeafClass).length){var a=e(this).closest(t._dotNodeClass);i.resetIndeterminate(a,t),s.prop("checked")?i.propagateToChildren(a,!0,t):i.propagateToChildren(a,!1,t)}i.propagateToParent(s,t),i.getLeafData(t),i.push()});for(var n=0;n<i.initValues.length;n++)s.find(t._dotCompositeClass).each(function(){var s=e(this).data("id");s==i.initValues[n]&&(i.propagateToChildren(e(this),!0,t),e(this).find(t._dotCheckboxClass).change())})}}}),e.fn[l]=function(e){var s=this.data(n);return s instanceof i?"undefined"!=typeof e&&s.init(e):(s=new i(this,e),this.data(n,s)),s}}(jQuery,window,document);